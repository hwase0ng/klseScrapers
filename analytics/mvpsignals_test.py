
'''
Created on Nov 15, 2018

@author: hwase0ng
'''

from mvpsignals import scanSignals
import pytest
import settings as S
from common import loadCfg


def setup_module():
    loadCfg(S.DATA_DIR)


@pytest.mark.parametrize("counter,pnlist,lasttxn,signals", [
    ("DUFU", [[[['2017-05-28', '2017-07-30', '2017-09-10', '2017-10-29', '2018-01-14', '2018-03-04', '2018-05-20'], ['2017-05-21', '2017-08-27', '2017-10-29', '2017-12-31', '2018-03-04', '2018-04-22', '2018-07-22'], ['2017-05-21', '2017-09-10', '2017-11-05', '2018-01-14', '2018-03-04', '2018-05-20', '2018-07-08'], ['2017-05-28', '2017-07-09', '2017-08-20', '2017-10-29', '2017-12-10', '2018-03-11', '2018-06-03']], [['2017-06-04', '2017-07-16', '2017-10-08', '2017-12-10', '2018-02-11', '2018-04-08', '2018-06-03', '2018-07-15'], ['2017-07-02', '2017-10-01', '2017-12-10', '2018-02-04', '2018-04-01', '2018-05-13', '2018-07-01'], ['2017-07-16', '2017-09-03', '2017-10-15', '2017-12-10', '2018-02-11', '2018-04-08', '2018-07-01'], ['2017-05-21', '2017-07-02', '2017-10-15', '2017-12-24', '2018-02-18', '2018-04-29', '2018-07-01']], [[1.5340000000000003, 1.3799999999999997, 1.5225, 1.444, 1.254, 1.166, 1.132], [10.0, 10.4, 7.4, 8.5, 7.4, 10.2, 8.2], [0.32199999999999995, 0.1125, 0.03, 0.066, -0.016, 0.062, -0.054000000000000006], [0.398, -0.278, 1.36, 0.42399999999999993, 2.8660000000000005, 0.03600000000000003, 0.22750000000000004]], [[1.418, 1.332, 1.3699999999999999, 1.09, 1.1320000000000001, 1.028, 1.04, 0.982], [4.666666666666667, 2.6, 4.0, 4.666666666666667, 5.8, 6.5, 6.0], [-0.098, 0.09999999999999999, -0.09400000000000001, -0.22400000000000003, -0.068, -0.096, -0.07], [-0.03599999999999998, -0.73, -0.6719999999999999, 0.16399999999999998, -0.8325, -0.6719999999999999, -0.7420000000000001]]], [[['2017-06-18', '2017-09-10', '2018-01-14', '2018-05-20'], ['2017-05-21', '2017-08-27', '2017-11-05', '2018-01-14', '2018-04-22'], ['2017-05-21', '2017-09-10', '2018-01-14', '2018-05-20'], ['2017-06-04', '2017-08-27', '2017-12-17', '2018-03-11', '2018-06-03']], [['2017-07-16', '2017-10-08', '2017-12-17', '2018-04-08', '2018-07-15'], ['2017-07-02', '2017-10-08', '2018-02-11', '2018-07-01'], ['2017-07-16', '2017-10-08', '2017-12-17', '2018-04-08', '2018-07-15'], ['2017-07-02', '2017-09-24', '2018-01-28', '2018-07-01']], [[1.5022222222222221, 1.5185714285714287, 1.2422222222222223, 1.1142857142857143], [9.666666666666666, 10.3, 7.1, 8.333333333333334, 9.0], [0.29555555555555557, 0.10714285714285714, 0.03666666666666667, 0.047142857142857146], [0.379, 1.0910000000000002, 1.9710000000000005, -0.009999999999999986, -0.046666666666666634]], [[1.36, 1.3710000000000004, 1.129, 1.052, 0.9969999999999999], [5.625, 2.6, 5.0, 6.2], [-0.08299999999999999, -0.07899999999999999, -0.189, -0.083, -0.06000000000000001], [-0.72875, -0.5833333333333334, -0.6930000000000001, -0.658]]], [[['2017-06-30', '2018-01-31', '2018-05-31'], ['2017-08-31', '2018-04-30'], ['2017-08-31', '2018-01-31', '2018-05-31'], ['2017-08-31', '2017-12-31']], [['2017-07-31', '2017-12-31', '2018-06-30'], ['2017-09-30', '2018-02-28', '2018-06-30'], ['2017-07-31', '2017-12-31', '2018-06-30'], ['2017-06-30', '2018-02-28', '2018-06-30']], [[1.4689473684210526, 1.2119047619047616, 1.0938888888888887], [9.045454545454545, 8.523809523809524], [0.04363636363636363, 0.030476190476190483, 0.022777777777777775], [0.47727272727272735, 1.3947368421052635]], [[1.3680952380952383, 1.1394736842105262, 1.0431578947368425], [4.111111111111111, 6.055555555555555, 6.368421052631579], [-0.06666666666666668, -0.1610526315789474, -0.044736842105263144], [-0.45368421052631575, -0.46166666666666667, -0.43105263157894735]]]], ['2018-07-25', 1.22, 1.0458333333333334, 7.277777777777778, -0.006111111111111113, 4.945555555555556], "DUFU,BRV,1,(0c,3m,3p,3v)"),
    ("DUFU", [[[['2017-05-28', '2017-07-30', '2017-09-10', '2017-10-29', '2018-01-14', '2018-03-04', '2018-05-20'], ['2017-05-21', '2017-08-27', '2017-10-29', '2017-12-31', '2018-03-04', '2018-04-22', '2018-07-22'], ['2017-05-21', '2017-09-10', '2017-11-05', '2018-01-14', '2018-03-04', '2018-05-20', '2018-07-08'], ['2017-05-28', '2017-07-09', '2017-08-20', '2017-10-29', '2017-12-10', '2018-03-11', '2018-06-03', '2018-07-29']], [['2017-06-04', '2017-07-16', '2017-10-08', '2017-12-10', '2018-02-11', '2018-04-08', '2018-06-03', '2018-07-15'], ['2017-07-02', '2017-10-01', '2017-12-10', '2018-02-04', '2018-04-01', '2018-05-13', '2018-07-01'], ['2017-07-16', '2017-09-03', '2017-10-15', '2017-12-10', '2018-02-11', '2018-04-08', '2018-07-01'], ['2017-05-21', '2017-07-02', '2017-10-15', '2017-12-24', '2018-02-18', '2018-04-29', '2018-07-01']], [[1.5340000000000003, 1.3799999999999997, 1.5225, 1.444, 1.254, 1.166, 1.132], [10.0, 10.4, 7.4, 8.5, 7.4, 10.2, 8.2], [0.32199999999999995, 0.1125, 0.03, 0.066, -0.016, 0.062, -0.054000000000000006], [0.398, -0.278, 1.36, 0.42399999999999993, 2.8660000000000005, 0.03600000000000003, 0.22750000000000004, 12.719999999999999]], [[1.418, 1.332, 1.3699999999999999, 1.09, 1.1320000000000001, 1.028, 1.04, 0.982], [4.666666666666667, 2.6, 4.0, 4.666666666666667, 5.8, 6.5, 6.0], [-0.098, 0.09999999999999999, -0.09400000000000001, -0.22400000000000003, -0.068, -0.096, -0.07], [-0.03599999999999998, -0.73, -0.6719999999999999, 0.16399999999999998, -0.8325, -0.6719999999999999, -0.7420000000000001]]], [[['2017-06-18', '2017-09-10', '2018-01-14', '2018-05-20'], ['2017-05-21', '2017-08-27', '2017-11-05', '2018-01-14', '2018-04-22'], ['2017-05-21', '2017-09-10', '2018-01-14', '2018-05-20'], ['2017-06-04', '2017-08-27', '2017-12-17', '2018-03-11', '2018-07-29']], [['2017-07-16', '2017-10-08', '2017-12-17', '2018-04-08', '2018-07-15'], ['2017-07-02', '2017-10-08', '2018-02-11', '2018-07-01'], ['2017-07-16', '2017-10-08', '2017-12-17', '2018-04-08', '2018-07-15'], ['2017-07-02', '2017-09-24', '2018-01-28', '2018-07-01']], [[1.5022222222222221, 1.5185714285714287, 1.2422222222222223, 1.1142857142857143], [9.666666666666666, 10.3, 7.1, 8.333333333333334, 9.0], [0.29555555555555557, 0.10714285714285714, 0.03666666666666667, 0.047142857142857146], [0.379, 1.0910000000000002, 1.9710000000000005, -0.009999999999999986, 9.532]], [[1.36, 1.3710000000000004, 1.129, 1.052, 0.9969999999999999], [5.625, 2.6, 5.0, 6.2], [-0.08299999999999999, -0.07899999999999999, -0.189, -0.083, -0.06000000000000001], [-0.72875, -0.5833333333333334, -0.6930000000000001, -0.658]]], [[['2017-09-30', '2018-01-31', '2018-05-31'], ['2017-08-31', '2018-04-30'], ['2017-08-31', '2018-01-31', '2018-05-31'], ['2017-08-31', '2017-12-31']], [['2017-07-31', '2017-12-31', '2018-06-30'], ['2017-09-30', '2018-02-28', '2018-06-30'], ['2017-07-31', '2017-12-31', '2018-06-30'], ['2017-06-30', '2018-02-28', '2018-06-30']], [[1.4633333333333334, 1.2119047619047616, 1.0938888888888887], [9.045454545454545, 8.523809523809524], [0.04363636363636363, 0.030476190476190483, 0.022777777777777775], [0.47727272727272735, 1.3947368421052635]], [[1.3680952380952383, 1.1394736842105262, 1.0431578947368425], [4.111111111111111, 6.055555555555555, 6.368421052631579], [-0.06666666666666668, -0.1610526315789474, -0.044736842105263144], [-0.45368421052631575, -0.46166666666666667, -0.43105263157894735]]]], ['2018-07-30', 1.22, 1.071190476190476, 7.428571428571429, 0.021904761904761903, 5.170952380952381], "DUFU,BRV,2,(0c,3m,3p,3v)"),
])
def test_signals(counter, pnlist, lasttxn, signals):
    result = scanSignals(False, counter, pnlist, lasttxn)
    assert result.replace('\t', '') == signals
