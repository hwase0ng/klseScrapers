
'''
Created on Nov 15, 2018

@author: hwase0ng
'''

from mvpsignals import scanSignals
import pytest
import settings as S
from common import loadCfg


def setup_module():
    loadCfg(S.DATA_DIR)


@pytest.mark.parametrize("counter,pnlist,lasttxn,expected", [
    ("PADINI", [[[['2014-05-04', '2014-07-27', '2014-09-14', '2014-11-09', '2014-12-28', '2015-02-22', '2015-04-12', '2015-06-07'], ['2014-05-04', '2014-06-15', '2014-08-03', '2014-09-28', '2014-11-09', '2015-02-01', '2015-04-12', '2015-06-07', '2015-07-26'], ['2014-05-04', '2014-07-27', '2014-10-05', '2014-11-30', '2015-02-22', '2015-04-12', '2015-06-07'], ['2014-05-04', '2014-06-29', '2014-09-07', '2014-10-26', '2014-12-21', '2015-02-08', '2015-04-05', '2015-05-24', '2015-07-12']], [['2014-06-15', '2014-08-31', '2014-10-26', '2015-01-18', '2015-03-15', '2015-05-24', '2015-07-19'], ['2014-05-18', '2014-07-20', '2014-09-07', '2014-10-26', '2015-01-04', '2015-03-22', '2015-05-31', '2015-07-12'], ['2014-06-15', '2014-09-07', '2014-10-26', '2014-12-21', '2015-02-08', '2015-05-10', '2015-07-19'], ['2014-05-18', '2014-07-27', '2014-09-28', '2014-11-23', '2015-01-04', '2015-03-08', '2015-05-17', '2015-08-02']], [[2.02, 1.9939999999999998, 1.924, 1.842, 1.5075, 1.4466666666666665, 1.442, 1.4133333333333333], [7.75, 9.8, 10.333333333333334, 7.8, 8.8, 4.4, 11.4, 7.0, 7.6], [0.0325, 0.034, -0.02, -0.01, 0.013333333333333334, 0.03, 0.016666666666666666], [-0.405, 0.492, 1.0524999999999998, 3.2099999999999995, 0.834, 1.5199999999999998, -0.312, 1.9920000000000002, 1.2639999999999998]], [[1.886, 1.888, 1.6966666666666665, 1.406, 1.3719999999999999, 1.376, 1.2974999999999999], [4.5, 8.25, 5.25, 6.0, 3.75, 7.0, 6.0, 5.8], [-0.044, -0.045, -0.10333333333333333, -0.152, -0.05000000000000001, -0.042499999999999996, -0.0675], [-0.64, -0.7699999999999999, -0.8859999999999999, -0.696, -0.3825, -0.792, -0.6275, -0.732]]], [[['2014-05-11', '2014-08-03', '2014-11-09', '2015-02-01', '2015-04-12'], ['2014-07-06', '2014-11-09', '2015-04-12', '2015-07-05'], ['2014-05-11', '2014-08-03', '2014-11-23', '2015-04-12'], ['2014-06-22', '2014-11-09', '2015-02-15', '2015-04-26', '2015-07-19']], [['2014-06-22', '2014-10-26', '2015-01-18', '2015-03-29', '2015-07-19'], ['2014-05-25', '2014-09-14', '2015-01-18', '2015-05-10', '2015-07-19'], ['2014-06-22', '2014-10-26', '2015-01-04', '2015-03-29', '2015-07-19'], ['2014-05-11', '2014-08-17', '2015-01-04', '2015-03-15', '2015-07-05']], [[1.9966666666666666, 1.9899999999999998, 1.8190000000000002, 1.45, 1.4419999999999997], [10.0, 7.8, 11.3, 7.333333333333333], [0.017777777777777778, 0.02875, -0.022, 0.02], [0.006999999999999995, 1.9409999999999996, 1.0550000000000002, 0.35, 0.8622222222222222]], [[1.8980000000000004, 1.74375, 1.4240000000000002, 1.3969999999999998, 1.3100000000000003], [5.333333333333333, 5.666666666666667, 4.2, 7.25, 5.888888888888889], [-0.039, -0.0825, -0.13375, -0.026000000000000002, -0.05777777777777778], [-0.5077777777777777, -0.701, -0.31375, -0.651, -0.10999999999999999]]], [[['2014-07-31', '2014-11-30', '2015-04-30'], ['2014-06-30', '2014-11-30', '2015-04-30'], ['2014-07-31', '2014-11-30', '2015-04-30'], ['2014-06-30', '2014-10-31', '2015-02-28', '2015-06-30']], [['2014-06-30', '2014-10-31', '2015-03-31', '2015-07-31'], ['2014-05-31', '2014-09-30', '2015-01-31', '2015-06-30'], ['2014-06-30', '2014-12-31', '2015-07-31'], ['2014-07-31', '2015-03-31']], [[1.97, 1.7785000000000004, 1.4195454545454542], [9.523809523809524, 6.75, 9.409090909090908], [0.021, -0.0175, 0.009999999999999997], [0.029047619047619058, 1.0018749999999998, 0.2931250000000001, 0.4358333333333333]], [[1.9233333333333331, 1.7743749999999998, 1.4063636363636365, 1.3280952380952382], [6.3, 6.352941176470588, 4.190476190476191, 6.75], [-0.027619047619047623, -0.11954545454545454, -0.03904761904761906], [-0.49000000000000005, -0.5495454545454547]]]], ['2015-08-07', 1.33, 1.352, 7.8, 0.012, -0.5820000000000001], "PADINI,BRV,2,(0c,3m,3p,3v)"),
    ("DUFU", [[[['2017-05-28', '2017-07-30', '2017-09-10', '2017-10-29', '2018-01-14', '2018-03-04', '2018-05-20'], ['2017-05-21', '2017-08-27', '2017-10-29', '2017-12-31', '2018-03-04', '2018-04-22', '2018-07-22'], ['2017-05-21', '2017-09-10', '2017-11-05', '2018-01-14', '2018-03-04', '2018-05-20', '2018-07-08'], ['2017-05-28', '2017-07-09', '2017-08-20', '2017-10-29', '2017-12-10', '2018-03-11', '2018-06-03']], [['2017-06-04', '2017-07-16', '2017-10-08', '2017-12-10', '2018-02-11', '2018-04-08', '2018-06-03', '2018-07-15'], ['2017-07-02', '2017-10-01', '2017-12-10', '2018-02-04', '2018-04-01', '2018-05-13', '2018-07-01'], ['2017-07-16', '2017-09-03', '2017-10-15', '2017-12-10', '2018-02-11', '2018-04-08', '2018-07-01'], ['2017-05-21', '2017-07-02', '2017-10-15', '2017-12-24', '2018-02-18', '2018-04-29', '2018-07-01']], [[1.5340000000000003, 1.3799999999999997, 1.5225, 1.444, 1.254, 1.166, 1.132], [10.0, 10.4, 7.4, 8.5, 7.4, 10.2, 8.2], [0.32199999999999995, 0.1125, 0.03, 0.066, -0.016, 0.062, -0.054000000000000006], [0.398, -0.278, 1.36, 0.42399999999999993, 2.8660000000000005, 0.03600000000000003, 0.22750000000000004]], [[1.418, 1.332, 1.3699999999999999, 1.09, 1.1320000000000001, 1.028, 1.04, 0.982], [4.666666666666667, 2.6, 4.0, 4.666666666666667, 5.8, 6.5, 6.0], [-0.098, 0.09999999999999999, -0.09400000000000001, -0.22400000000000003, -0.068, -0.096, -0.07], [-0.03599999999999998, -0.73, -0.6719999999999999, 0.16399999999999998, -0.8325, -0.6719999999999999, -0.7420000000000001]]], [[['2017-06-18', '2017-09-10', '2018-01-14', '2018-05-20'], ['2017-05-21', '2017-08-27', '2017-11-05', '2018-01-14', '2018-04-22'], ['2017-05-21', '2017-09-10', '2018-01-14', '2018-05-20'], ['2017-06-04', '2017-08-27', '2017-12-17', '2018-03-11', '2018-06-03']], [['2017-07-16', '2017-10-08', '2017-12-17', '2018-04-08', '2018-07-15'], ['2017-07-02', '2017-10-08', '2018-02-11', '2018-07-01'], ['2017-07-16', '2017-10-08', '2017-12-17', '2018-04-08', '2018-07-15'], ['2017-07-02', '2017-09-24', '2018-01-28', '2018-07-01']], [[1.5022222222222221, 1.5185714285714287, 1.2422222222222223, 1.1142857142857143], [9.666666666666666, 10.3, 7.1, 8.333333333333334, 9.0], [0.29555555555555557, 0.10714285714285714, 0.03666666666666667, 0.047142857142857146], [0.379, 1.0910000000000002, 1.9710000000000005, -0.009999999999999986, -0.046666666666666634]], [[1.36, 1.3710000000000004, 1.129, 1.052, 0.9969999999999999], [5.625, 2.6, 5.0, 6.2], [-0.08299999999999999, -0.07899999999999999, -0.189, -0.083, -0.06000000000000001], [-0.72875, -0.5833333333333334, -0.6930000000000001, -0.658]]], [[['2017-06-30', '2018-01-31', '2018-05-31'], ['2017-08-31', '2018-04-30'], ['2017-08-31', '2018-01-31', '2018-05-31'], ['2017-08-31', '2017-12-31']], [['2017-07-31', '2017-12-31', '2018-06-30'], ['2017-09-30', '2018-02-28', '2018-06-30'], ['2017-07-31', '2017-12-31', '2018-06-30'], ['2017-06-30', '2018-02-28', '2018-06-30']], [[1.4689473684210526, 1.2119047619047616, 1.0938888888888887], [9.045454545454545, 8.523809523809524], [0.04363636363636363, 0.030476190476190483, 0.022777777777777775], [0.47727272727272735, 1.3947368421052635]], [[1.3680952380952383, 1.1394736842105262, 1.0431578947368425], [4.111111111111111, 6.055555555555555, 6.368421052631579], [-0.06666666666666668, -0.1610526315789474, -0.044736842105263144], [-0.45368421052631575, -0.46166666666666667, -0.43105263157894735]]]], ['2018-07-25', 1.22, 1.0458333333333334, 7.277777777777778, -0.006111111111111113, 4.945555555555556], "DUFU,BRV,1,(0c,3m,3p,3v)"),
    ("DUFU", [[[['2017-05-28', '2017-07-30', '2017-09-10', '2017-10-29', '2018-01-14', '2018-03-04', '2018-05-20'], ['2017-05-21', '2017-08-27', '2017-10-29', '2017-12-31', '2018-03-04', '2018-04-22', '2018-07-22'], ['2017-05-21', '2017-09-10', '2017-11-05', '2018-01-14', '2018-03-04', '2018-05-20', '2018-07-08'], ['2017-05-28', '2017-07-09', '2017-08-20', '2017-10-29', '2017-12-10', '2018-03-11', '2018-06-03', '2018-07-29']], [['2017-06-04', '2017-07-16', '2017-10-08', '2017-12-10', '2018-02-11', '2018-04-08', '2018-06-03', '2018-07-15'], ['2017-07-02', '2017-10-01', '2017-12-10', '2018-02-04', '2018-04-01', '2018-05-13', '2018-07-01'], ['2017-07-16', '2017-09-03', '2017-10-15', '2017-12-10', '2018-02-11', '2018-04-08', '2018-07-01'], ['2017-05-21', '2017-07-02', '2017-10-15', '2017-12-24', '2018-02-18', '2018-04-29', '2018-07-01']], [[1.5340000000000003, 1.3799999999999997, 1.5225, 1.444, 1.254, 1.166, 1.132], [10.0, 10.4, 7.4, 8.5, 7.4, 10.2, 8.2], [0.32199999999999995, 0.1125, 0.03, 0.066, -0.016, 0.062, -0.054000000000000006], [0.398, -0.278, 1.36, 0.42399999999999993, 2.8660000000000005, 0.03600000000000003, 0.22750000000000004, 12.719999999999999]], [[1.418, 1.332, 1.3699999999999999, 1.09, 1.1320000000000001, 1.028, 1.04, 0.982], [4.666666666666667, 2.6, 4.0, 4.666666666666667, 5.8, 6.5, 6.0], [-0.098, 0.09999999999999999, -0.09400000000000001, -0.22400000000000003, -0.068, -0.096, -0.07], [-0.03599999999999998, -0.73, -0.6719999999999999, 0.16399999999999998, -0.8325, -0.6719999999999999, -0.7420000000000001]]], [[['2017-06-18', '2017-09-10', '2018-01-14', '2018-05-20'], ['2017-05-21', '2017-08-27', '2017-11-05', '2018-01-14', '2018-04-22'], ['2017-05-21', '2017-09-10', '2018-01-14', '2018-05-20'], ['2017-06-04', '2017-08-27', '2017-12-17', '2018-03-11', '2018-07-29']], [['2017-07-16', '2017-10-08', '2017-12-17', '2018-04-08', '2018-07-15'], ['2017-07-02', '2017-10-08', '2018-02-11', '2018-07-01'], ['2017-07-16', '2017-10-08', '2017-12-17', '2018-04-08', '2018-07-15'], ['2017-07-02', '2017-09-24', '2018-01-28', '2018-07-01']], [[1.5022222222222221, 1.5185714285714287, 1.2422222222222223, 1.1142857142857143], [9.666666666666666, 10.3, 7.1, 8.333333333333334, 9.0], [0.29555555555555557, 0.10714285714285714, 0.03666666666666667, 0.047142857142857146], [0.379, 1.0910000000000002, 1.9710000000000005, -0.009999999999999986, 9.532]], [[1.36, 1.3710000000000004, 1.129, 1.052, 0.9969999999999999], [5.625, 2.6, 5.0, 6.2], [-0.08299999999999999, -0.07899999999999999, -0.189, -0.083, -0.06000000000000001], [-0.72875, -0.5833333333333334, -0.6930000000000001, -0.658]]], [[['2017-09-30', '2018-01-31', '2018-05-31'], ['2017-08-31', '2018-04-30'], ['2017-08-31', '2018-01-31', '2018-05-31'], ['2017-08-31', '2017-12-31']], [['2017-07-31', '2017-12-31', '2018-06-30'], ['2017-09-30', '2018-02-28', '2018-06-30'], ['2017-07-31', '2017-12-31', '2018-06-30'], ['2017-06-30', '2018-02-28', '2018-06-30']], [[1.4633333333333334, 1.2119047619047616, 1.0938888888888887], [9.045454545454545, 8.523809523809524], [0.04363636363636363, 0.030476190476190483, 0.022777777777777775], [0.47727272727272735, 1.3947368421052635]], [[1.3680952380952383, 1.1394736842105262, 1.0431578947368425], [4.111111111111111, 6.055555555555555, 6.368421052631579], [-0.06666666666666668, -0.1610526315789474, -0.044736842105263144], [-0.45368421052631575, -0.46166666666666667, -0.43105263157894735]]]], ['2018-07-30', 1.22, 1.071190476190476, 7.428571428571429, 0.021904761904761903, 5.170952380952381], "DUFU,BRV,2,(0c,3m,3p,3v)"),
])
def test_bottom_reversal_success(counter, pnlist, lasttxn, expected):
    result = scanSignals(0, counter, pnlist, lasttxn)
    assert result.replace('\t', '') == expected, "*** Input = " + counter + "," + lasttxn[0]


# AZRB,2018-11-15 - TopP
@pytest.mark.parametrize("counter,pnlist,lasttxn,expected", [
    ("PADINI", [[[['2014-04-20', '2014-06-01', '2014-07-27', '2014-09-14', '2014-11-09', '2014-12-28', '2015-02-22', '2015-04-12'], ['2014-03-16', '2014-06-15', '2014-08-03', '2014-09-28', '2014-11-09', '2015-02-01', '2015-04-12'], ['2014-03-23', '2014-05-04', '2014-07-27', '2014-10-05', '2014-11-30', '2015-02-22', '2015-04-12'], ['2014-03-23', '2014-05-04', '2014-06-29', '2014-09-07', '2014-10-26', '2014-12-21', '2015-02-08', '2015-04-05', '2015-05-24']], [['2014-03-30', '2014-06-15', '2014-08-31', '2014-10-26', '2015-01-18', '2015-03-15', '2015-05-24'], ['2014-05-18', '2014-07-20', '2014-09-07', '2014-10-26', '2015-01-04', '2015-03-22', '2015-05-31'], ['2014-04-27', '2014-06-15', '2014-09-07', '2014-10-26', '2014-12-21', '2015-02-08', '2015-05-10'], ['2014-03-30', '2014-05-18', '2014-07-27', '2014-09-28', '2014-11-23', '2015-01-04', '2015-03-08', '2015-05-17']], [[2.0700000000000003, 2.002, 1.9939999999999998, 1.924, 1.842, 1.5075, 1.4466666666666665, 1.442], [10.8, 9.8, 10.333333333333334, 7.8, 8.8, 4.4, 11.4], [0.238, 0.0325, 0.034, -0.02, -0.01, 0.013333333333333334, 0.03], [2.318, -0.405, 0.492, 1.0524999999999998, 3.2099999999999995, 0.834, 1.5199999999999998, -0.312, 1.9920000000000002]], [[1.8860000000000003, 1.886, 1.888, 1.6966666666666665, 1.406, 1.3719999999999999, 1.376], [4.5, 8.25, 5.25, 6.0, 3.75, 7.0, 6.0], [0.024, -0.044, -0.045, -0.10333333333333333, -0.152, -0.05000000000000001, -0.042499999999999996], [0.578, -0.64, -0.7699999999999999, -0.8859999999999999, -0.696, -0.3825, -0.792, -0.6275]]], [[['2014-04-20', '2014-08-10', '2014-11-16', '2015-02-08', '2015-04-19'], ['2014-08-10', '2014-11-16', '2015-04-19'], ['2014-03-23', '2014-07-27', '2014-11-16', '2015-04-19'], ['2014-03-23', '2014-06-29', '2014-11-02', '2015-02-08', '2015-05-31']], [['2014-04-06', '2014-06-15', '2014-11-02', '2015-03-22'], ['2014-05-18', '2014-09-07', '2015-01-25', '2015-05-31'], ['2014-06-15', '2014-09-07', '2014-12-28', '2015-03-22'], ['2014-05-18', '2014-10-05', '2014-12-14', '2015-03-08', '2015-05-17']], [[2.032, 1.9774999999999998, 1.814, 1.44375, 1.4359999999999997], [9.75, 8.3, 10.6], [0.215, 0.02888888888888889, -0.017, 0.029999999999999992], [1.9470000000000003, 0.26799999999999996, 2.22125, 0.7337499999999999, 0.9390000000000001]], [[1.9260000000000002, 1.911, 1.75875, 1.3719999999999999], [5.333333333333333, 5.888888888888889, 4.1, 6.6], [-0.036000000000000004, -0.044444444444444446, -0.1422222222222222, -0.044], [-0.6122222222222222, -0.8449999999999999, -0.35, -0.654, -0.29625]]], [[['2014-04-30', '2014-11-30', '2015-04-30'], ['2014-06-30', '2014-11-30', '2015-04-30'], ['2014-07-31', '2014-11-30', '2015-04-30'], ['2014-06-30', '2014-10-31', '2015-05-31']], [['2014-06-30', '2014-10-31', '2015-05-31'], ['2014-05-31', '2014-09-30', '2015-01-31'], ['2014-06-30', '2014-12-31', '2015-05-31'], ['2014-07-31', '2015-03-31']], [[2.011818181818182, 1.7785000000000004, 1.4195454545454542], [9.523809523809524, 6.75, 9.409090909090908], [0.021, -0.0175, 0.009999999999999997], [0.029047619047619058, 1.0018749999999998, 0.38999999999999996]], [[1.9233333333333331, 1.7743749999999998, 1.3827777777777774], [6.3, 6.352941176470588, 4.190476190476191], [-0.027619047619047623, -0.11954545454545454, -0.02888888888888889], [-0.49000000000000005, -0.5495454545454547]]]], ['2015-06-05', 1.4, 1.4133333333333333, 7.0, 0.016666666666666666, -0.06666666666666667], "PADINI,Dbg,0,(0c,3m,3p,3v)"),
    ("AZRB", [[[['2017-09-17', '2017-10-29', '2018-01-14', '2018-02-25', '2018-04-22', '2018-06-10', '2018-08-19', '2018-11-11'], ['2017-09-03', '2017-11-12', '2018-01-14', '2018-03-11', '2018-04-29', '2018-06-17', '2018-08-05', '2018-10-07'], ['2017-09-17', '2017-11-05', '2018-01-14', '2018-03-25', '2018-05-06', '2018-07-01', '2018-08-12', '2018-10-07'], ['2018-05-20', '2018-07-22']], [['2017-08-27', '2017-10-22', '2017-12-24', '2018-02-18', '2018-04-08', '2018-06-03', '2018-09-16', '2018-10-28'], ['2017-10-22', '2017-12-03', '2018-02-11', '2018-04-08', '2018-05-20', '2018-07-01', '2018-09-09', '2018-10-28'], ['2017-10-22', '2017-12-10', '2018-02-18', '2018-04-08', '2018-06-03', '2018-09-16', '2018-10-28'], None], [[1.1640000000000001, 1.152, 1.04, 0.8800000000000001, 0.7559999999999999, 0.418, 0.523, 0.36124999999999996], [11.0, 10.0, 9.2, 5.0, 9.25, 8.25, 8.6, 7.8], [0.06000000000000001, 0.016, 0.054000000000000006, -0.11, -0.005, -0.048, 0.306, -0.156], [215.196, 4.709999999999999]], [[1.078, 1.1150000000000002, 0.942, 0.8733333333333334, 0.6910000000000001, 0.37374999999999997, 0.39999999999999997, 0.326], [7.0, 5.0, 3.2, 4.2, 5.2, 6.6, 4.4, 5.2], [-0.035, -0.148, -0.13, -0.16799999999999998, -0.5, -0.21, -0.198], None]], [[['2017-09-17', '2018-01-21', '2018-04-29', '2018-08-19'], ['2017-09-03', '2017-11-12', '2018-01-21', '2018-06-24', '2018-10-14'], ['2017-09-17', '2018-01-21', '2018-05-13', '2018-08-19'], ['2018-05-27']], [['2017-10-15', '2017-12-24', '2018-04-15', '2018-07-08', '2018-10-28'], ['2017-12-10', '2018-02-18', '2018-05-27', '2018-09-16'], ['2017-12-24', '2018-03-04', '2018-05-27', '2018-10-28'], None], [[1.1588888888888889, 1.0145, 0.7483333333333333, 0.5155], [10.375, 9.1, 8.6, 8.222222222222221, 7.4], [0.05222222222222222, 0.043000000000000003, -0.006666666666666667, 0.276], [146.59499999999997]], [[1.121, 0.9564999999999999, 0.7094999999999999, 0.37700000000000006, 0.329], [5.222222222222222, 3.625, 5.5, 4.5], [-0.123, -0.145, -0.45199999999999996, -0.19699999999999998], None]], [[['2017-09-30', '2018-01-31', '2018-08-31'], ['2018-01-31', '2018-06-30'], ['2017-09-30', '2018-01-31', '2018-08-31'], ['2018-05-31']], [['2017-12-31', '2018-06-30', '2018-10-31'], ['2017-10-31', '2018-02-28', '2018-09-30'], ['2017-12-31', '2018-05-31', '2018-10-31'], None], [[1.1472222222222221, 0.9988095238095239, 0.4976190476190477], [7.714285714285714, 7.7], [0.04722222222222224, 0.021904761904761913, 0.1842857142857143], [88.28277777777778]], [[0.9594736842105261, 0.39899999999999997, 0.3450000000000001], [7.571428571428571, 3.588235294117647, 5.588235294117647], [-0.1205263157894737, -0.3355555555555555, -0.18739130434782614], None]]], ['2018-11-15', 0.355, 0.358, 8.6, -0.005000000000000001, -0.653], "AZRB,Dbg,0,(0c,3m,3p,0v)"),
])
def test_bottom_reversal_fail(counter, pnlist, lasttxn, expected):
    result = scanSignals(1, counter, pnlist, lasttxn)
    assert result.replace('\t', '') == expected, "*** Input = " + counter + "," + lasttxn[0]


@pytest.mark.parametrize("counter,pnlist,lasttxn,expected", [
    ("PADINI", [[[['2015-12-27', '2016-03-06', '2016-05-29', '2016-09-11', '2016-10-30', '2016-12-18', '2017-01-29'], ['2015-12-27', '2016-03-06', '2016-05-15', '2016-06-26', '2016-08-14', '2016-10-23', '2017-01-01', '2017-02-19'], ['2015-12-27', '2016-02-07', '2016-03-27', '2016-05-15', '2016-08-14', '2016-10-30', '2017-01-08'], ['2016-01-24', '2016-03-13', '2016-05-08', '2016-07-17', '2016-08-28', '2016-10-23', '2016-12-04', '2017-01-22']], [['2016-01-10', '2016-04-17', '2016-06-26', '2016-08-28', '2016-10-16', '2016-12-11', '2017-01-22'], ['2016-01-03', '2016-03-20', '2016-05-22', '2016-07-10', '2016-09-04', '2016-11-20', '2017-01-22'], ['2016-01-24', '2016-03-20', '2016-06-26', '2016-08-28', '2016-10-16', '2016-12-04', '2017-01-22'], ['2016-01-03', '2016-02-21', '2016-04-03', '2016-05-29', '2016-07-10', '2016-10-02', '2016-11-20', '2017-01-01', '2017-02-19']], [[1.97, 2.16, 2.3840000000000003, 3.008, 2.922, 2.605, 2.4520000000000004], [8.666666666666666, 10.4, 8.0, 5.5, 11.0, 9.0, 7.25, 9.8], [0.20666666666666667, 0.1025, -0.0275, 0.156, 0.186, 0.02, -0.037500000000000006], [1.0379999999999998, -0.22799999999999998, 2.0775, 0.48, 0.738, 0.9339999999999999, 2.962, 2.302]], [[1.8559999999999999, 1.964, 2.2675, 2.7340000000000004, 2.7640000000000002, 2.58, 2.396], [7.75, 6.8, 6.6, 3.6666666666666665, 5.5, 6.4, 5.0], [0.017999999999999995, -0.052000000000000005, -0.035, 0.044, -0.06000000000000001, -0.096, -0.074], [-0.5825, -0.33399999999999996, -0.7939999999999999, -0.29, -0.8700000000000001, -0.636, -0.404, -0.865, 0.062]]], [[['2015-12-27', '2016-03-06', '2016-05-29', '2016-09-18'], ['2015-12-13', '2016-03-06', '2016-05-15', '2016-08-07', '2016-10-30', '2017-02-19'], ['2015-12-27', '2016-05-15', '2016-08-21', '2016-11-13'], ['2016-02-07', '2016-05-01', '2016-09-04', '2016-12-11']], [['2016-01-10', '2016-04-17', '2016-06-26', '2016-10-16', '2017-02-05'], ['2016-01-10', '2016-04-03', '2016-07-10', '2016-10-16', '2017-01-22'], ['2016-01-24', '2016-04-17', '2016-06-26', '2016-09-04', '2016-12-11'], ['2016-01-10', '2016-04-03', '2016-07-10', '2016-10-02', '2017-01-08']], [[1.91875, 2.15, 2.3419999999999996, 2.9825000000000004], [8.3, 10.0, 7.888888888888889, 10.4, 8.9, 9.444444444444445], [0.18, 0.12666666666666662, 0.14900000000000002, 0.016], [0.7325, 1.4360000000000002, 0.5855555555555555, 2.402]], [[1.8677777777777775, 1.9989999999999999, 2.281111111111111, 2.7655555555555558, 2.4325], [8.0, 7.111111111111111, 3.8333333333333335, 7.0, 5.7], [0.036000000000000004, -0.03599999999999999, -0.023333333333333334, 0.06444444444444444, -0.096], [-0.12444444444444443, -0.7311111111111112, -0.5933333333333333, -0.583, -0.73625]]], [[['2016-05-31', '2016-09-30'], ['2016-01-31', '2016-08-31'], ['2015-12-31', '2016-05-31', '2016-11-30'], ['2016-01-31', '2016-05-31']], [['2016-03-31', '2017-01-31'], ['2016-06-30', '2017-01-31'], ['2016-03-31', '2016-12-31'], ['2016-03-31', '2016-09-30']], [[2.3199999999999994, 2.9225000000000008], [8.947368421052632, 8.909090909090908], [0.15857142857142859, 0.1219047619047619, -0.013636363636363636], [0.58, 0.6052380952380952]], [[2.0572727272727276, 2.4675000000000007], [5.7368421052631575, 6.3], [-0.01090909090909091, -0.08000000000000002], [-0.5322727272727272, -0.4334999999999999]]]], ['2017-02-22', 2.73, 2.4921428571428565, 8.857142857142858, -0.0007142857142857149, 1.147142857142857], "PADINI,BRV,3,(3c,3m,1p,3v)"),
    ("PADINI", [[[['2015-12-27', '2016-03-06', '2016-05-29', '2016-09-11', '2016-10-30', '2016-12-18', '2017-01-29'], ['2015-12-27', '2016-03-06', '2016-05-15', '2016-06-26', '2016-08-14', '2016-10-23', '2017-01-01'], ['2015-12-27', '2016-02-07', '2016-03-27', '2016-05-15', '2016-08-14', '2016-10-30', '2017-01-08'], ['2015-12-06', '2016-01-24', '2016-03-13', '2016-05-08', '2016-07-17', '2016-08-28', '2016-10-23', '2016-12-04', '2017-01-22']], [['2015-11-22', '2016-01-10', '2016-04-17', '2016-06-26', '2016-08-28', '2016-10-16', '2016-12-11', '2017-01-22'], ['2016-01-03', '2016-03-20', '2016-05-22', '2016-07-10', '2016-09-04', '2016-11-20', '2017-01-22'], ['2015-11-29', '2016-01-24', '2016-03-20', '2016-06-26', '2016-08-28', '2016-10-16', '2016-12-04', '2017-01-22'], ['2016-01-03', '2016-02-21', '2016-04-03', '2016-05-29', '2016-07-10', '2016-10-02', '2016-11-20', '2017-01-01']], [[1.97, 2.16, 2.3840000000000003, 3.008, 2.922, 2.605, 2.4520000000000004], [8.666666666666666, 10.4, 8.0, 5.5, 11.0, 9.0, 7.25], [0.20666666666666667, 0.1025, -0.0275, 0.156, 0.186, 0.02, -0.037500000000000006], [1.008, 1.0379999999999998, -0.22799999999999998, 2.0775, 0.48, 0.738, 0.9339999999999999, 2.962, 2.302]], [[1.598, 1.8559999999999999, 1.964, 2.2675, 2.7340000000000004, 2.7640000000000002, 2.58, 2.396], [7.75, 6.8, 6.6, 3.6666666666666665, 5.5, 6.4, 5.0], [0.062, 0.017999999999999995, -0.052000000000000005, -0.035, 0.044, -0.06000000000000001, -0.096, -0.074], [-0.5825, -0.33399999999999996, -0.7939999999999999, -0.29, -0.8700000000000001, -0.636, -0.404, -0.865]]], [[['2015-12-27', '2016-03-06', '2016-05-29', '2016-09-18'], ['2016-03-06', '2016-05-15', '2016-08-07', '2016-10-30', '2017-01-08'], ['2015-12-27', '2016-05-15', '2016-08-21', '2016-11-13'], ['2016-02-07', '2016-05-01', '2016-09-04', '2016-12-11']], [['2015-11-29', '2016-04-17', '2016-06-26', '2016-10-16'], ['2016-01-10', '2016-04-03', '2016-07-10', '2016-10-16', '2017-01-22'], ['2016-01-24', '2016-04-17', '2016-06-26', '2016-09-04', '2016-12-11'], ['2016-01-10', '2016-04-03', '2016-07-10', '2016-10-02', '2017-01-08']], [[1.91875, 2.15, 2.3419999999999996, 2.9825000000000004], [10.0, 7.888888888888889, 10.4, 8.9, 7.0], [0.18, 0.12666666666666662, 0.14900000000000002, 0.016], [0.7325, 1.4360000000000002, 0.5855555555555555, 2.402]], [[1.6, 1.9989999999999999, 2.281111111111111, 2.7655555555555558], [8.0, 7.111111111111111, 3.8333333333333335, 7.0, 5.7], [0.036000000000000004, -0.03599999999999999, -0.023333333333333334, 0.06444444444444444, -0.096], [-0.12444444444444443, -0.7311111111111112, -0.5933333333333333, -0.583, -0.73625]]], [[['2016-05-31', '2016-09-30'], ['2016-01-31', '2016-08-31'], ['2015-12-31', '2016-05-31', '2016-11-30'], ['2016-01-31', '2016-05-31']], [['2016-03-31'], ['2015-12-31', '2016-06-30', '2017-01-31'], ['2016-03-31', '2016-12-31'], ['2016-03-31', '2016-09-30']], [[2.3199999999999994, 2.9225000000000008], [8.947368421052632, 8.909090909090908], [0.15857142857142859, 0.1219047619047619, -0.013636363636363636], [0.58, 0.6052380952380952]], [[2.0572727272727276], [8.19047619047619, 5.7368421052631575, 6.3], [-0.01090909090909091, -0.08000000000000002], [-0.5322727272727272, -0.4334999999999999]]]], ['2017-02-06', 2.42, 2.393333333333333, 8.0, -0.06333333333333334, 2.9266666666666663], "PADINI,BRV,3,(3c,3m,1p,3v)"),
])
def test_retracement_success(counter, pnlist, lasttxn, expected):
    result = scanSignals(0, counter, pnlist, lasttxn)
    assert result.replace('\t', '') == expected, "*** Input = " + counter + "," + lasttxn[0]


@pytest.mark.parametrize("counter,pnlist,lasttxn,expected", [
    ("PADINI", [[[['2013-08-11', '2013-09-22', '2013-12-29', '2014-02-16', '2014-04-20', '2014-06-01', '2014-07-27', '2014-09-14'], ['2013-08-25', '2013-10-20', '2013-12-29', '2014-03-16', '2014-06-15', '2014-08-03', '2014-09-28'], ['2013-08-11', '2013-09-22', '2013-12-22', '2014-03-23', '2014-05-04', '2014-07-27', '2014-10-05'], ['2013-08-11', '2013-10-20', '2013-12-01', '2014-02-02', '2014-03-23', '2014-05-04', '2014-06-29', '2014-09-07', '2014-10-26']], [['2013-09-01', '2013-11-17', '2014-02-09', '2014-03-30', '2014-06-15', '2014-08-31', '2014-10-26'], ['2013-09-01', '2013-12-01', '2014-02-16', '2014-05-18', '2014-07-20', '2014-09-07', '2014-10-26'], ['2013-09-01', '2013-11-17', '2014-02-09', '2014-04-27', '2014-06-15', '2014-09-07', '2014-10-26'], ['2013-09-22', '2013-11-03', '2014-01-19', '2014-03-30', '2014-05-18', '2014-07-27', '2014-09-28']], [[1.8050000000000002, 1.8025, 1.7925, 1.6179999999999999, 2.0700000000000003, 2.002, 1.9939999999999998, 1.924], [8.0, 9.5, 9.0, 10.8, 9.8, 10.333333333333334, 7.8], [-0.035, 0.02, 0.05, 0.238, 0.0325, 0.034, -0.02], [1.755, 0.5675, 1.8559999999999999, 0.6374999999999998, 2.318, -0.405, 0.492, 1.0524999999999998, 3.2099999999999995]], [[1.7259999999999998, 1.67, 1.5950000000000002, 1.8860000000000003, 1.886, 1.888, 1.6966666666666665], [6.4, 4.4, 1.4, 4.5, 8.25, 5.25, 6.0], [-0.052000000000000005, -0.057999999999999996, -0.10500000000000001, 0.024, -0.044, -0.045, -0.10333333333333333], [-0.8175, -0.518, -0.2866666666666667, 0.578, -0.64, -0.7699999999999999, -0.8859999999999999]]], [[['2013-08-18', '2013-10-27', '2014-01-05', '2014-04-27', '2014-08-03'], ['2013-10-27', '2014-01-05', '2014-03-16', '2014-07-06', '2014-09-28'], ['2013-09-29', '2013-12-22', '2014-03-30', '2014-08-03'], ['2013-08-18', '2013-12-22', '2014-03-30', '2014-06-22', '2014-09-14']], [['2013-09-01', '2013-11-24', '2014-02-16', '2014-06-22', '2014-10-26'], ['2013-09-15', '2013-11-24', '2014-02-16', '2014-05-25', '2014-09-14'], ['2013-09-01', '2013-11-24', '2014-02-16', '2014-06-22', '2014-10-26'], ['2013-09-29', '2014-01-19', '2014-05-11', '2014-08-17']], [[1.7928571428571427, 1.7777777777777777, 1.7900000000000003, 2.032, 1.9899999999999998], [9.222222222222221, 9.0, 10.3, 10.0, 7.125], [0.015555555555555557, 0.045, 0.18000000000000002, 0.02875], [0.32857142857142857, 1.8170000000000002, 1.448, 0.006999999999999995, 0.7666666666666666]], [[1.7459999999999998, 1.674, 1.6077777777777778, 1.8980000000000004, 1.74375], [7.1, 4.9, 2.111111111111111, 5.333333333333333, 5.666666666666667], [-0.049, -0.05499999999999999, -0.09444444444444444, -0.039, -0.0825], [-0.77, -0.13499999999999995, -0.5077777777777777, -0.701]]], [[['2013-09-30', '2014-04-30'], ['2013-10-31', '2014-03-31'], ['2013-09-30', '2014-03-31', '2014-07-31'], ['2014-03-31', '2014-10-31']], [['2014-02-28', '2014-06-30', '2014-10-31'], ['2014-02-28', '2014-09-30'], ['2014-02-28', '2014-06-30', '2014-10-31'], ['2013-09-30', '2014-01-31', '2014-07-31']], [[1.782, 2.011818181818182], [8.5, 9.666666666666666], [0.0035000000000000005, 0.16476190476190475, 0.021], [1.319047619047619, 1.0018749999999998]], [[1.6321052631578947, 1.9233333333333331, 1.7743749999999998], [4.2105263157894735, 6.352941176470588], [-0.06052631578947369, -0.027619047619047623, -0.06875], [-0.6195, 0.11473684210526312, -0.49000000000000005]]]], ['2014-11-05', 1.84, 1.8333333333333333, 8.666666666666666, -0.02666666666666667, 0.9333333333333335], "PADINI,Dbg,0,(3c,3m,1p,3v)"),
])
def test_retracement_fail(counter, pnlist, lasttxn, expected):
    result = scanSignals(1, counter, pnlist, lasttxn)
    assert result.replace('\t', '') == expected, "*** Input = " + counter + "," + lasttxn[0]


# PADINI,2011-10-12,OVS8 without OVS2 due to low V
# PETRONM,2013-04-24,OVS3
@pytest.mark.parametrize("counter,pnlist,lasttxn,expected", [
    ("PADINI", [[[['2010-08-08', '2010-09-19', '2010-11-21', '2011-01-16', '2011-03-06', '2011-05-01', '2011-06-19', '2011-09-04'], ['2010-07-18', '2010-09-12', '2010-11-21', '2011-01-02', '2011-02-20', '2011-04-24', '2011-07-24'], ['2010-07-18', '2010-10-03', '2010-11-14', '2011-01-16', '2011-03-13', '2011-05-01', '2011-06-19', '2011-07-31', '2011-09-25'], ['2010-08-08', '2010-10-10', '2010-11-28', '2011-01-09', '2011-05-01', '2011-06-19', '2011-09-04']], [['2010-07-25', '2010-09-26', '2010-12-05', '2011-01-23', '2011-03-27', '2011-05-29', '2011-07-10', '2011-10-02'], ['2010-08-15', '2010-10-17', '2010-12-05', '2011-02-06', '2011-03-27', '2011-06-05', '2011-08-28'], ['2010-08-22', '2010-10-31', '2010-12-26', '2011-03-27', '2011-07-10', '2011-08-28'], ['2010-07-04', '2010-08-22', '2010-10-03', '2010-12-19', '2011-02-13', '2011-04-10', '2011-07-03', '2011-08-21', '2011-10-09']], [[0.8048, 0.925, 1.0605, 1.19, 1.0899999999999999, 1.154, 1.114, 0.9275], [11.666666666666666, 13.0, 9.0, 11.0, 7.5, 12.4, 10.2], [0.09000000000000001, 0.16999999999999998, 0.10600000000000001, 0.198, -0.044000000000000004, 0.11599999999999999, 0.003999999999999998, 0.016, -0.08499999999999999], [4.966, 2.6100000000000003, -0.12, 4.658, 4.006, 1.084, 2.065]], [[0.7920000000000001, 0.8995000000000001, 0.9835, 1.1325, 1.014, 1.094, 1.052, 0.841], [7.75, 6.25, 4.75, 4.0, 3.0, 6.2, 3.4], [0.03666666666666667, 0.06666666666666667, -0.057999999999999996, -0.078, -0.046, -0.15000000000000002], [-0.21250000000000002, -0.6266666666666666, -0.97, -0.68, -0.85, -0.668, -0.798, 0.06, -0.8219999999999998]]], [[['2010-10-17', '2011-01-23', '2011-05-15', '2011-07-24'], ['2010-09-19', '2011-01-09', '2011-05-01', '2011-07-24'], ['2010-07-25', '2010-10-17', '2011-01-23', '2011-05-01', '2011-08-07'], ['2010-08-08', '2010-10-17', '2011-01-09', '2011-05-01', '2011-09-04']], [['2010-10-31', '2011-04-03', '2011-07-10', '2011-10-02'], ['2010-08-22', '2010-12-12', '2011-03-20', '2011-06-12', '2011-09-04'], ['2010-08-22', '2010-12-26', '2011-04-03', '2011-06-12', '2011-09-04'], ['2010-10-03', '2010-12-12', '2011-02-20', '2011-07-10']], [[0.9773333333333333, 1.1644444444444444, 1.1155555555555554, 1.076], [12.571428571428571, 10.333333333333334, 12.2, 9.9], [0.08166666666666667, 0.15333333333333332, 0.1722222222222222, 0.06799999999999999, 0.009], [4.302222222222223, 1.4833333333333334, 3.285555555555556, 2.0640000000000005, 2.0285714285714285]], [[0.9745000000000001, 1.03, 1.0560000000000003, 0.8616666666666667], [8.0, 5.0, 4.2, 6.2, 3.7142857142857144], [0.038571428571428576, -0.0525, -0.06000000000000001, -0.018, -0.1457142857142857], [-0.7916666666666666, -0.5587500000000001, -0.8000000000000002, -0.7040000000000001]]], [[['2011-01-31', '2011-05-31'], ['2010-09-30', '2011-04-30'], ['2010-09-30', '2011-01-31', '2011-05-31'], ['2010-08-31', '2011-01-31', '2011-05-31']], [['2010-12-31'], ['2010-10-31', '2011-03-31', '2011-09-30'], ['2010-08-31', '2011-03-31', '2011-09-30'], ['2010-09-30', '2011-02-28', '2011-06-30']], [[1.1570000000000003, 1.107], [11.533333333333333, 11.142857142857142], [0.12533333333333332, 0.14649999999999996, 0.03500000000000001], [2.1252941176470586, 1.8965000000000007, 1.3215000000000001]], [[1.0052222222222222], [6.833333333333333, 4.391304347826087, 5.315789473684211], [0.04941176470588237, -0.05695652173913044, -0.10210526315789475], [-0.5746666666666668, -0.72875, -0.11545454545454549]]]], ['2011-10-12', 1.02, 0.8887500000000002, 7.75, -0.03375, -0.68625], "PADINI,OVS,8,0,(1c,3m,1p,3v)"),
    ("PADINI", [[[['2013-01-06', '2013-02-17', '2013-04-14', '2013-06-02', '2013-07-14', '2013-09-22', '2013-12-29', '2014-02-16'], ['2013-01-13', '2013-03-03', '2013-04-14', '2013-06-02', '2013-08-25', '2013-10-20', '2013-12-29'], ['2013-01-13', '2013-03-17', '2013-06-02', '2013-08-11', '2013-09-22', '2013-12-22'], ['2012-12-16', '2013-02-10', '2013-04-14', '2013-05-26', '2013-08-11', '2013-10-20', '2013-12-01', '2014-02-02']], [['2013-01-27', '2013-05-05', '2013-07-07', '2013-09-01', '2013-11-17', '2014-02-09'], ['2012-12-16', '2013-01-27', '2013-05-05', '2013-07-21', '2013-09-01', '2013-12-01', '2014-02-16'], ['2012-12-16', '2013-01-27', '2013-03-31', '2013-05-12', '2013-07-07', '2013-09-01', '2013-11-17', '2014-02-09'], ['2013-01-13', '2013-02-24', '2013-04-21', '2013-06-09', '2013-08-04', '2013-09-22', '2013-11-03', '2014-01-19']], [[1.8699999999999999, 1.8966666666666665, 1.97, 2.1119999999999997, 1.8820000000000001, 1.8025, 1.7925, 1.6179999999999999], [6.8, 12.8, 9.4, 9.0, 8.0, 9.5, 9.0], [0.024, 0.05, 0.156, -0.035, 0.02, 0.05], [0.78, 0.8619999999999999, 2.4, 0.385, 1.755, 0.5675, 1.8559999999999999, 0.6374999999999998]], [[1.7775, 1.7925, 1.866, 1.7259999999999998, 1.67, 1.5950000000000002], [3.4, 3.75, 3.5, 3.8, 6.4, 4.4, 1.4], [-0.094, -0.022500000000000003, 0.030000000000000006, -0.07, -0.11399999999999999, -0.052000000000000005, -0.057999999999999996, -0.10500000000000001], [-0.55, -0.558, -0.050000000000000024, -0.8459999999999999, -0.24000000000000005, -0.8175, -0.518, -0.2866666666666667]]], [[['2013-01-06', '2013-03-17', '2013-06-09', '2013-09-29', '2014-01-05'], ['2013-03-03', '2013-06-09', '2013-10-27', '2014-01-05'], ['2013-03-17', '2013-06-09', '2013-09-29', '2013-12-22'], ['2012-12-23', '2013-04-14', '2013-07-21', '2013-10-13', '2013-12-22']], [['2013-02-03', '2013-05-12', '2013-09-01', '2013-11-24', '2014-02-16'], ['2012-12-23', '2013-05-12', '2013-07-21', '2013-11-24', '2014-02-16'], ['2012-12-23', '2013-03-03', '2013-07-07', '2013-11-24', '2014-02-16'], ['2013-01-06', '2013-03-17', '2013-06-23', '2013-09-29', '2014-01-19']], [[1.8525, 1.8960000000000001, 2.1049999999999995, 1.79, 1.7900000000000003], [12.0, 8.6, 9.222222222222221, 9.0], [0.039, 0.156, 0.015555555555555557, 0.045], [0.43400000000000005, 1.382, 0.593, 0.24700000000000005, 1.8170000000000002]], [[1.8000000000000003, 1.795555555555556, 1.7459999999999998, 1.674, 1.6077777777777778], [3.7, 4.111111111111111, 4.3, 4.9, 2.111111111111111], [-0.09199999999999998, -0.003, -0.09999999999999999, -0.05499999999999999, -0.09444444444444444], [-0.06750000000000003, -0.354, -0.64, -0.77, -0.13499999999999995]]], [[['2013-01-31', '2013-06-30', '2013-12-31'], ['2013-03-31', '2013-10-31'], ['2013-01-31', '2013-06-30', '2013-12-31'], ['2013-04-30', '2013-12-31']], [['2013-02-28', '2013-11-30'], ['2013-07-31', '2013-11-30'], ['2013-02-28', '2013-07-31', '2013-11-30'], ['2013-06-30', '2014-01-31']], [[1.8344999999999998, 2.0220000000000002, 1.7771428571428571], [10.523809523809524, 8.5], [0.003, 0.05500000000000001, 0.03857142857142858], [0.9104545454545453, 1.0580952380952384]], [[1.8317647058823525, 1.7080000000000002], [4.695652173913044, 5.05], [-0.0029411764705882353, -0.08695652173913046, -0.03350000000000001], [-0.6950000000000001, 0.11473684210526312]]]], ['2014-02-27', 1.73, 1.6249999999999998, 3.9444444444444446, -0.06722222222222224, 0.523888888888889], "PADINI,OVS,1,0,(1c,3m,3p,3v)"),
    ("PADINI", [[[['2013-01-06', '2013-02-17', '2013-04-14', '2013-06-02', '2013-07-14', '2013-09-22', '2013-12-29', '2014-02-16'], ['2013-01-13', '2013-03-03', '2013-04-14', '2013-06-02', '2013-08-25', '2013-10-20', '2013-12-29'], ['2013-01-13', '2013-03-17', '2013-06-02', '2013-08-11', '2013-09-22', '2013-12-22'], ['2013-02-10', '2013-04-14', '2013-05-26', '2013-08-11', '2013-10-20', '2013-12-01', '2014-02-02']], [['2013-01-27', '2013-05-05', '2013-07-07', '2013-09-01', '2013-11-17', '2014-02-09'], ['2013-01-27', '2013-05-05', '2013-07-21', '2013-09-01', '2013-12-01', '2014-02-16'], ['2013-01-27', '2013-03-31', '2013-05-12', '2013-07-07', '2013-09-01', '2013-11-17', '2014-02-09'], ['2013-01-13', '2013-02-24', '2013-04-21', '2013-06-09', '2013-08-04', '2013-09-22', '2013-11-03', '2014-01-19']], [[1.8699999999999999, 1.8966666666666665, 1.97, 2.1119999999999997, 1.8820000000000001, 1.8025, 1.7925, 1.6179999999999999], [6.8, 12.8, 9.4, 9.0, 8.0, 9.5, 9.0], [0.024, 0.05, 0.156, -0.035, 0.02, 0.05], [0.8619999999999999, 2.4, 0.385, 1.755, 0.5675, 1.8559999999999999, 0.6374999999999998]], [[1.7775, 1.7925, 1.866, 1.7259999999999998, 1.67, 1.5950000000000002], [3.75, 3.5, 3.8, 6.4, 4.4, 1.4], [-0.022500000000000003, 0.030000000000000006, -0.07, -0.11399999999999999, -0.052000000000000005, -0.057999999999999996, -0.10500000000000001], [-0.55, -0.558, -0.050000000000000024, -0.8459999999999999, -0.24000000000000005, -0.8175, -0.518, -0.2866666666666667]]], [[['2013-01-13', '2013-03-24', '2013-06-02', '2013-09-22', '2013-12-29'], ['2013-03-10', '2013-06-02', '2013-10-20', '2013-12-29'], ['2013-01-13', '2013-03-24', '2013-06-16', '2013-10-06', '2013-12-29'], ['2013-02-10', '2013-04-21', '2013-07-28', '2013-12-15']], [['2013-01-27', '2013-05-05', '2013-09-08', '2013-11-17', '2014-02-09'], ['2013-01-27', '2013-05-05', '2013-07-28', '2013-12-01', '2014-02-23'], ['2013-01-27', '2013-05-05', '2013-07-14', '2013-11-17', '2014-02-09'], ['2013-02-24', '2013-06-16', '2013-09-22', '2014-01-26']], [[1.8688888888888888, 1.9130000000000003, 2.0922222222222224, 1.7844444444444447, 1.7844444444444447], [12.4, 8.88888888888889, 8.666666666666666, 8.666666666666666], [0.013333333333333332, 0.043000000000000003, 0.13900000000000004, 0.007999999999999998, 0.049999999999999996], [0.6225, 1.1749999999999998, 0.687, 1.211]], [[1.8033333333333335, 1.8155555555555556, 1.7549999999999997, 1.6977777777777776, 1.60375], [4.444444444444445, 4.111111111111111, 4.3, 4.7, 2.7], [-0.010000000000000002, -0.05, -0.10399999999999998, -0.04111111111111111, -0.09999999999999999], [-0.54625, -0.8389999999999999, -0.81, -0.185]]], [[['2013-01-31', '2013-06-30', '2013-12-31'], ['2013-03-31', '2013-10-31'], ['2013-01-31', '2013-06-30', '2013-12-31'], ['2013-04-30', '2013-12-31']], [['2013-02-28', '2013-08-31', '2014-02-28'], ['2013-07-31', '2014-02-28'], ['2013-02-28', '2013-07-31', '2014-02-28'], ['2013-06-30', '2014-01-31']], [[1.8344999999999998, 2.0220000000000002, 1.7771428571428571], [10.523809523809524, 8.5], [0.003, 0.05500000000000001, 0.03857142857142858], [0.9104545454545453, 1.0580952380952384]], [[1.8317647058823525, 1.7657894736842108, 1.6321052631578947], [4.695652173913044, 4.2105263157894735], [-0.0029411764705882353, -0.08695652173913046, -0.06052631578947369], [-0.6950000000000001, 0.11473684210526312]]]], ['2014-03-07', 1.84, 1.826, 9.8, 0.11800000000000002, 0.7819999999999999], "PADINI,OVS,8,0,(0c,1m,3p,3v)"),
    ("PADINI", [[[['2013-02-17', '2013-04-14', '2013-06-02', '2013-07-14', '2013-09-22', '2013-12-29', '2014-03-23'], ['2013-03-03', '2013-04-14', '2013-06-02', '2013-08-25', '2013-10-20', '2013-12-29', '2014-03-16'], ['2013-02-03', '2013-03-17', '2013-06-02', '2013-08-11', '2013-09-22', '2013-12-22', '2014-03-23'], ['2013-02-10', '2013-04-14', '2013-05-26', '2013-08-11', '2013-10-20', '2013-12-01', '2014-02-02', '2014-03-23']], [['2013-01-27', '2013-05-05', '2013-07-07', '2013-09-01', '2013-11-17', '2014-02-09'], ['2013-01-27', '2013-05-05', '2013-07-21', '2013-09-01', '2013-12-01', '2014-02-16'], ['2013-01-27', '2013-03-31', '2013-05-12', '2013-07-07', '2013-09-01', '2013-11-17', '2014-02-09'], ['2013-02-24', '2013-04-21', '2013-06-09', '2013-08-04', '2013-09-22', '2013-11-03', '2014-01-19']], [[1.8966666666666665, 1.97, 2.1119999999999997, 1.8820000000000001, 1.8025, 1.7925, 2.012], [12.8, 9.4, 9.0, 8.0, 9.5, 9.0, 10.8], [0.0033333333333333335, 0.05, 0.156, -0.035, 0.02, 0.05, 0.238], [0.8619999999999999, 2.4, 0.385, 1.755, 0.5675, 1.8559999999999999, 0.6374999999999998, 2.318]], [[1.7775, 1.7925, 1.866, 1.7259999999999998, 1.67, 1.5950000000000002], [3.75, 3.5, 3.8, 6.4, 4.4, 1.4], [-0.022500000000000003, 0.030000000000000006, -0.07, -0.11399999999999999, -0.052000000000000005, -0.057999999999999996, -0.10500000000000001], [-0.558, -0.050000000000000024, -0.8459999999999999, -0.24000000000000005, -0.8175, -0.518, -0.2866666666666667]]], [[['2013-03-24', '2013-06-02', '2013-09-22', '2013-12-29', '2014-03-23'], ['2013-03-10', '2013-06-02', '2013-10-20', '2013-12-29', '2014-03-23'], ['2013-03-24', '2013-06-16', '2013-10-06', '2013-12-29', '2014-03-23'], ['2013-02-10', '2013-04-21', '2013-07-28', '2013-12-15', '2014-03-23']], [['2013-01-27', '2013-05-05', '2013-09-08', '2013-11-17', '2014-02-09'], ['2013-01-27', '2013-05-05', '2013-07-28', '2013-12-01', '2014-02-23'], ['2013-01-27', '2013-05-05', '2013-07-14', '2013-11-17', '2014-02-09'], ['2013-02-24', '2013-06-16', '2013-09-22', '2014-01-26']], [[1.9130000000000003, 2.0922222222222224, 1.7844444444444447, 1.7844444444444447, 1.9649999999999999], [12.4, 8.88888888888889, 8.666666666666666, 8.666666666666666, 10.2], [0.043000000000000003, 0.13900000000000004, 0.007999999999999998, 0.049999999999999996, 0.215], [0.6225, 1.1749999999999998, 0.687, 1.211, 1.9470000000000003]], [[1.8033333333333335, 1.8155555555555556, 1.7549999999999997, 1.6977777777777776, 1.60375], [4.444444444444445, 4.111111111111111, 4.3, 4.7, 2.7], [-0.010000000000000002, -0.05, -0.10399999999999998, -0.04111111111111111, -0.09999999999999999], [-0.54625, -0.8389999999999999, -0.81, -0.185]]], [[['2013-06-30', '2013-12-31'], ['2013-03-31', '2013-10-31'], ['2013-06-30', '2013-12-31'], ['2013-04-30', '2013-12-31']], [['2013-04-30', '2013-08-31', '2014-02-28'], ['2013-07-31', '2014-02-28'], ['2013-02-28', '2013-07-31', '2014-02-28'], ['2013-06-30', '2014-01-31']], [[2.0220000000000002, 1.7771428571428571], [10.523809523809524, 8.5], [0.05500000000000001, 0.03857142857142858], [0.9104545454545453, 1.0580952380952384]], [[1.8913636363636364, 1.7657894736842108, 1.6321052631578947], [4.695652173913044, 4.2105263157894735], [-0.0029411764705882353, -0.08695652173913046, -0.06052631578947369], [-0.6950000000000001, 0.11473684210526312]]]], ['2014-03-27', 1.9, 1.911578947368421, 9.842105263157896, 0.17105263157894737, 1.3689473684210525], "PADINI,OVS,8,1,(0c,1m,3p,3v)"),
    ("PETRONM", [[[['2012-02-19', '2012-05-06', '2012-07-15', '2012-09-16', '2012-11-18', '2013-01-06', '2013-02-17', '2013-04-21'], ['2012-02-26', '2012-05-20', '2012-07-15', '2012-09-30', '2012-11-18', '2013-01-20', '2013-03-24'], ['2012-02-19', '2012-05-06', '2012-07-15', '2012-11-18', '2013-01-13', '2013-04-21'], ['2012-02-12', '2012-04-15', '2012-05-27', '2012-07-22', '2012-09-09', '2012-11-04', '2012-12-30', '2013-03-17']], [['2012-04-08', '2012-07-01', '2012-10-14', '2012-12-02', '2013-01-13', '2013-03-03'], ['2012-04-08', '2012-06-24', '2012-09-02', '2012-10-21', '2012-12-02', '2013-02-17', '2013-04-14'], ['2012-03-25', '2012-06-10', '2012-09-09', '2012-12-16', '2013-02-24'], ['2012-03-18', '2012-06-10', '2012-08-05', '2012-10-14', '2012-12-09', '2013-02-24', '2013-04-14']], [[3.8659999999999997, 3.585, 3.374, 2.7859999999999996, 2.9499999999999997, 2.89, 2.8166666666666664, 2.982], [7.8, 7.4, 8.0, 5.4, 8.666666666666666, 8.6, 10.6], [0.078, 0.0, 0.006, 0.07666666666666667, 0.016, 0.05], [1.6433333333333333, 2.315, -0.792, 1.53, 1.5500000000000003, 1.226, 1.7925, 1.222]], [[3.568, 3.312, 2.7359999999999998, 2.7920000000000003, 2.882, 2.784], [5.6, 5.6, 2.0, 3.0, 3.4, 6.333333333333333, 8.6], [-0.034, -0.06, -0.152, -0.024, -0.032], [-0.48599999999999993, -0.9175, -0.37399999999999994, -0.844, -0.572, -0.45199999999999996, 0.08999999999999997]]], [[['2012-02-19', '2012-05-13', '2012-07-22', '2012-11-25'], ['2012-02-19', '2012-07-22', '2012-09-30', '2013-01-20', '2013-03-31'], ['2012-02-19', '2012-05-13', '2012-07-22', '2012-11-25', '2013-03-31'], ['2012-04-15', '2012-09-02', '2013-01-06', '2013-03-17']], [['2012-04-15', '2012-06-24', '2012-10-14', '2013-03-03'], ['2012-04-15', '2012-06-24', '2012-09-02', '2012-12-09', '2013-02-17'], ['2012-04-01', '2012-06-10', '2012-09-16', '2012-12-23', '2013-03-03'], ['2012-03-18', '2012-06-10', '2012-10-14', '2013-03-03']], [[3.815, 3.58, 3.357, 2.93], [7.25, 7.5, 5.111111111111111, 8.4, 9.7], [0.06875, 0.0, 0.004, 0.06625, 0.015000000000000003], [1.9555555555555557, 1.4185714285714286, 0.97375, 0.553]], [[3.572222222222222, 3.3340000000000005, 2.742, 2.7849999999999997], [5.666666666666667, 6.0, 2.142857142857143, 3.5, 6.5], [-0.031000000000000007, -0.05666666666666667, -0.138, -0.018000000000000002, -0.028000000000000004], [-0.404, -0.8822222222222221, -0.714, -0.418]]], [[['2012-07-31', '2012-11-30'], ['2012-05-31', '2012-11-30', '2013-03-31'], ['2012-07-31', '2012-11-30'], ['2012-04-30', '2012-08-31', '2013-01-31']], [['2012-06-30', '2012-10-31', '2013-02-28'], ['2012-04-30', '2012-08-31', '2012-12-31'], ['2012-03-31', '2012-09-30', '2013-02-28'], ['2012-06-30', '2012-10-31', '2013-02-28']], [[3.3418181818181822, 2.905], [7.2727272727272725, 6.05, 9.095238095238095], [-0.003181818181818182, 0.05], [1.482, 0.7755, 0.11799999999999997]], [[3.338, 2.759090909090909, 2.7964705882352936], [5.9, 3.05, 5.55], [-0.02090909090909092, -0.11157894736842106, -0.02764705882352941], [-0.596, -0.37954545454545446, -0.3752941176470589]]]], ['2013-04-24', 2.95, 2.91, 8.777777777777779, 0.028333333333333335, 0.5055555555555558], "PETRONM,OVS,3,0,(1c,2m,3p,3v)"),
])
def test_oversold_success(counter, pnlist, lasttxn, expected):
    result = scanSignals(0, counter, pnlist, lasttxn)
    assert result.replace('\t', '') == expected, "*** Input = " + counter + "," + lasttxn[0]


# BTM 2018-11-15 disqualified OVS1 due to prevtopP
# CHOOBEE 2018-11-15 disqualified OVS1 due to lower P
# BONIA 2018-11-15 disqualified OVS2 due to no lower P
#     1. maxC in clist[0] position
#     2. price on new low vs PADINI 2011-09-30 retrace from high
# BENALEC 2018-11-15 disqualified OVS2 due to prevtopP
@pytest.mark.parametrize("counter,pnlist,lasttxn,expected", [
    ("BENALEC", [[[['2017-09-24', '2017-11-05', '2018-01-14', '2018-02-25', '2018-04-15', '2018-07-29'], ['2017-09-10', '2017-11-05', '2017-12-24', '2018-02-11', '2018-05-20', '2018-07-22', '2018-10-07'], ['2017-09-24', '2017-11-05', '2018-01-14', '2018-03-04', '2018-05-20', '2018-07-29', '2018-10-07'], ['2017-09-24', '2017-11-05', '2018-01-07', '2018-03-18', '2018-06-10', '2018-07-29', '2018-09-16', '2018-11-04']], [['2017-09-17', '2017-10-29', '2017-12-10', '2018-01-28', '2018-03-11', '2018-05-13', '2018-07-08', '2018-08-19', '2018-11-04'], ['2017-10-01', '2017-12-03', '2018-01-28', '2018-04-01', '2018-06-10', '2018-09-16', '2018-10-28'], ['2017-09-17', '2017-10-29', '2017-12-10', '2018-02-18', '2018-04-08', '2018-07-01', '2018-10-21'], ['2017-09-03', '2017-10-15', '2017-12-10', '2018-02-18', '2018-05-06', '2018-07-15', '2018-09-02', '2018-10-28']], [[0.4325, 0.42400000000000004, 0.41100000000000003, 0.384, 0.31399999999999995, 0.303], [10.0, 9.0, 8.6, 10.0, 11.0, 13.4, 11.6], [0.045000000000000005, 0.009999999999999998, 0.08600000000000001, -0.028000000000000004, -0.026000000000000002, 0.16, -0.132], [0.3499999999999999, 2.6599999999999997, 2.8925, 0.982, 0.7220000000000001, 4.864, -0.30333333333333334, 0.756]], [[0.421, 0.4109999999999999, 0.375, 0.395, 0.363, 0.2925, 0.255, 0.288, 0.20299999999999999], [5.8, 4.75, 8.0, 2.6, 8.6, 7.333333333333333, 8.6], [0.014000000000000002, -0.028000000000000004, -0.1, -0.0675, -0.162, -0.11199999999999999, -0.16399999999999998], [-0.3333333333333334, -0.48, -0.7979999999999999, -0.8375, -0.7533333333333333, -0.49399999999999994, -0.8, -0.031999999999999994]]], [[['2017-09-24', '2018-01-14', '2018-05-20', '2018-08-12'], ['2017-11-05', '2018-02-11', '2018-05-20', '2018-07-29', '2018-10-07'], ['2017-09-24', '2018-01-14', '2018-05-20', '2018-08-12'], ['2017-11-05', '2018-01-14', '2018-07-29', '2018-11-04']], [['2017-12-17', '2018-05-06', '2018-07-15'], ['2017-12-03', '2018-04-08', '2018-09-23'], ['2017-12-17', '2018-04-22', '2018-07-01', '2018-11-04'], ['2017-09-10', '2017-12-17', '2018-02-25', '2018-05-06', '2018-09-09']], [[0.42611111111111116, 0.40777777777777785, 0.30214285714285716, 0.289], [8.9, 10.0, 10.714285714285714, 13.2, 10.7], [0.027777777777777776, 0.07444444444444445, -0.04428571428571428, 0.121], [1.153, 2.1422222222222222, 3.194, 0.362]], [[0.376, 0.29312499999999997, 0.25599999999999995], [5.333333333333333, 3.0, 7.714285714285714], [-0.088, -0.147, -0.11100000000000002, -0.15699999999999997], [-0.24285714285714288, -0.7499999999999999, -0.5244444444444444, -0.6362500000000001, -0.6533333333333334]]], [[['2017-09-30', '2018-01-31', '2018-08-31'], ['2017-10-31', '2018-02-28', '2018-07-31'], ['2017-09-30', '2018-01-31', '2018-08-31'], ['2018-01-31', '2018-07-31']], [['2017-12-31', '2018-06-30'], ['2017-11-30', '2018-03-31', '2018-09-30'], ['2017-12-31', '2018-04-30', '2018-10-31'], ['2017-12-31', '2018-05-31', '2018-09-30']], [[0.423611111111111, 0.40142857142857136, 0.2864285714285715], [8.238095238095237, 9.11111111111111, 11.772727272727273], [0.017777777777777774, 0.04714285714285715, 0.0580952380952381], [0.971428571428571, 1.22]], [[0.3821052631578946, 0.26799999999999996], [6.7272727272727275, 4.681818181818182, 8.529411764705882], [-0.05105263157894737, -0.14904761904761904, -0.15130434782608695], [-0.4289473684210526, -0.5817647058823529, -0.4270588235294118]]]], ['2018-11-15', 0.205, 0.20400000000000001, 10.6, -0.10500000000000001, 0.5269999999999999], "BENALEC,Dbg,0,(1c,3m,1p,3v)"),
    ("BTM", [[[['2017-08-06', '2017-09-17', '2017-11-12', '2018-02-18', '2018-05-20', '2018-08-19', '2018-09-30'], ['2017-07-23', '2017-09-03', '2017-10-22', '2018-01-07', '2018-02-25', '2018-05-06', '2018-07-01', '2018-08-19', '2018-10-21'], ['2017-08-06', '2017-09-17', '2017-11-12', '2018-02-18', '2018-05-20', '2018-08-19', '2018-09-30'], ['2017-07-23', '2017-09-17', '2017-10-29', '2018-01-14', '2018-02-25', '2018-06-17', '2018-08-19']], [['2017-08-20', '2017-11-05', '2017-12-31', '2018-02-11', '2018-04-22', '2018-07-15', '2018-09-23', '2018-11-04'], ['2017-08-13', '2017-09-24', '2017-12-10', '2018-02-11', '2018-04-08', '2018-06-10', '2018-08-12', '2018-09-23'], ['2017-07-30', '2017-09-24', '2017-11-05', '2017-12-31', '2018-02-11', '2018-04-01', '2018-07-01', '2018-08-12', '2018-09-23', '2018-11-04'], ['2017-08-20', '2017-10-15', '2017-12-10', '2018-02-04', '2018-03-25', '2018-05-20', '2018-07-29', '2018-10-07']], [[0.251, 0.25200000000000006, 0.281, 0.26625, 0.16375, 0.158, 0.13], [8.6, 8.0, 10.5, 9.0, 9.2, 10.333333333333334, 10.2, 8.2, 6.5], [-0.041999999999999996, 0.028000000000000004, 0.148, 0.05500000000000001, 0.06, 0.11400000000000002, -0.14400000000000002], [0.358, 0.132, 9.599999999999998, 2.64, 23.901999999999997, 2.83, 34.132]], [[0.23899999999999996, 0.265, 0.245, 0.22125, 0.149, 0.14, 0.12, 0.10000000000000002], [6.6, 8.0, 7.666666666666667, 8.25, 4.4, 7.2, 6.6, 3.5], [-0.08600000000000001, -0.02, 0.086, -0.08499999999999999, -0.11750000000000001, -0.308, -0.06799999999999999, 0.026000000000000002, -0.2125, -0.20333333333333337], [-0.9339999999999999, -0.6125, -0.8999999999999999, -0.7200000000000001, -0.9199999999999999, -0.8375000000000001, -0.8139999999999998, -0.9575]]], [[['2017-09-03', '2017-11-12', '2018-01-21', '2018-05-27', '2018-08-19'], ['2017-07-23', '2017-10-29', '2018-02-04', '2018-05-13', '2018-09-02'], ['2017-11-12', '2018-01-21', '2018-05-27', '2018-08-19'], ['2017-10-29', '2018-03-04', '2018-08-19']], [['2017-10-01', '2018-01-07', '2018-04-29', '2018-07-22', '2018-10-28'], ['2017-08-20', '2017-12-10', '2018-03-18', '2018-06-10', '2018-09-30'], ['2017-07-23', '2017-10-01', '2018-01-07', '2018-04-01', '2018-07-08', '2018-10-14'], ['2017-09-03', '2017-12-10', '2018-04-01', '2018-08-05', '2018-10-14']], [[0.25, 0.273, 0.256, 0.15777777777777777, 0.15250000000000002], [8.0, 9.88888888888889, 9.0, 10.25, 7.5], [0.11700000000000002, -0.015, 0.028888888888888884, 0.07], [7.272222222222221, 16.796, 17.542]], [[0.24083333333333332, 0.246, 0.15, 0.14142857142857143, 0.10944444444444444], [7.1, 7.833333333333333, 4.9, 7.666666666666667, 4.111111111111111], [-0.07699999999999999, -0.016666666666666666, -0.06999999999999999, -0.3, -0.06400000000000002, -0.175], [-0.8066666666666666, -0.8650000000000001, -0.8720000000000001, -0.7166666666666667, -0.91375]]], [[['2017-11-30', '2018-05-31'], ['2017-10-31', '2018-05-31'], ['2017-11-30', '2018-08-31'], ['2017-10-31', '2018-02-28', '2018-08-31']], [['2017-08-31', '2018-04-30', '2018-10-31'], ['2017-08-31', '2018-03-31', '2018-09-30'], ['2018-03-31', '2018-10-31'], ['2017-08-31', '2017-12-31', '2018-07-31']], [[0.2659523809523809, 0.1553333333333333], [9.45, 9.4], [0.05047619047619048, 0.06157894736842106], [3.5375, 9.48470588235294, 12.361578947368422]], [[0.24525000000000002, 0.15199999999999994, 0.11263157894736846], [7.2, 5.409090909090909, 4.5625], [-0.27045454545454545, -0.16894736842105265], [-0.7360000000000001, -0.7223076923076923, -0.7070588235294119]]]], ['2018-11-15', 0.155, 0.12875, 7.75, 0.05374999999999999, 7.22125], "BTM,Dbg,0,(0c,1m,3p,2v)"),
    ("BONIA", [[[['2017-10-15', '2018-01-14', '2018-02-25', '2018-05-27', '2018-08-26', '2018-10-28'], ['2017-10-08', '2017-11-19', '2018-01-14', '2018-03-04', '2018-05-20', '2018-07-01', '2018-08-26', '2018-11-11'], ['2017-09-24', '2018-01-14', '2018-03-04', '2018-05-27', '2018-07-29', '2018-10-28'], ['2017-09-10', '2017-12-10', '2018-02-04', '2018-03-25', '2018-05-20', '2018-07-29', '2018-10-14']], [['2017-09-03', '2017-10-29', '2017-12-31', '2018-03-11', '2018-05-13', '2018-07-08', '2018-11-04'], ['2017-09-24', '2017-11-12', '2018-02-04', '2018-04-15', '2018-06-10', '2018-07-22', '2018-09-16', '2018-11-04'], ['2017-10-01', '2017-12-10', '2018-02-11', '2018-04-08', '2018-07-01', '2018-08-19', '2018-11-04'], ['2017-09-03', '2017-11-05', '2018-01-21', '2018-03-04', '2018-05-06', '2018-06-17', '2018-09-02', '2018-11-04']], [[0.664, 0.5559999999999999, 0.513, 0.4779999999999999, 0.44625, 0.334], [8.0, 7.0, 9.6, 9.2, 9.6, 8.2, 9.5, 8.5], [0.14500000000000002, 0.062, -0.008, 0.082, 0.05600000000000001, -0.134], [7.59, 3.7119999999999997, 1.626666666666667, 0.278, 2.646, 5.186, 3.6]], [[0.57, 0.644, 0.50625, 0.476, 0.405, 0.414, 0.265], [7.5, 5.8, 3.3333333333333335, 3.2, 5.6, 5.8, 4.0, 6.6], [0.08800000000000001, -0.198, -0.084, -0.11200000000000002, -0.098, 0.02, -0.28400000000000003], [0.10999999999999995, -0.86, -0.5700000000000001, -0.644, -0.8375, -0.865, -0.485, -0.55]]], [[['2017-10-22', '2018-01-14', '2018-06-03', '2018-08-26'], ['2017-10-08', '2018-01-14', '2018-05-20', '2018-08-26'], ['2017-09-24', '2018-01-14', '2018-03-25', '2018-06-03', '2018-08-12'], ['2017-09-10', '2017-12-17', '2018-05-20', '2018-07-29', '2018-10-07']], [['2017-10-08', '2018-02-11', '2018-05-06', '2018-07-15'], ['2017-11-05', '2018-02-11', '2018-04-22', '2018-09-23'], ['2017-12-17', '2018-05-06', '2018-11-04'], ['2017-11-05', '2018-01-28', '2018-04-22', '2018-07-01', '2018-09-09']], [[0.6622222222222223, 0.5433333333333333, 0.4655555555555555, 0.44], [7.9, 9.333333333333334, 9.428571428571429, 9.333333333333334], [0.14333333333333334, 0.01666666666666667, -0.019, 0.060000000000000005, 0.041999999999999996], [4.384285714285714, 1.843, 1.6785714285714286, 2.818, 1.9129999999999998]], [[0.634, 0.48875, 0.4222222222222223, 0.4165], [6.1, 3.5, 4.2, 4.428571428571429], [-0.18999999999999997, -0.0922222222222222, -0.20900000000000002], [-0.8149999999999998, -0.24400000000000005, -0.748, -0.7689999999999999, -0.3088888888888889]]], [[['2017-10-31', '2018-05-31'], ['2018-01-31', '2018-08-31'], ['2017-09-30', '2018-01-31', '2018-08-31'], ['2017-09-30', '2018-05-31', '2018-10-31']], [['2017-12-31', '2018-07-31'], ['2017-11-30', '2018-04-30', '2018-09-30'], ['2017-12-31', '2018-04-30'], ['2017-10-31', '2018-06-30']], [[0.6545238095238096, 0.4519444444444444], [7.904761904761905, 8.761904761904763], [0.11333333333333334, 0.009523809523809525, 0.020476190476190474], [2.9694444444444446, 1.2311111111111113, 0.9213043478260871]], [[0.5105263157894738, 0.4270454545454545], [6.5, 4.857142857142857, 5.176470588235294], [-0.16684210526315787, -0.09333333333333337], [-0.38999999999999996, -0.5265]]]], ['2018-11-15', 0.27, 0.2785, 8.0, -0.20299999999999999, -0.183], "BONIA,Dbg,0,(1c,3m,3p,3v)"),
    ("CHOOBEE", [[[['2017-09-24', '2017-11-05', '2018-01-14', '2018-02-25', '2018-05-20', '2018-07-22', '2018-09-02', '2018-11-04'], ['2017-09-24', '2017-12-31', '2018-03-04', '2018-04-15', '2018-07-22', '2018-10-07'], ['2017-09-24', '2017-11-05', '2018-01-07', '2018-02-25', '2018-05-20', '2018-07-22', '2018-09-16'], ['2017-09-24', '2017-12-03', '2018-01-21', '2018-03-11', '2018-06-03', '2018-08-19', '2018-10-14']], [['2017-09-03', '2017-11-26', '2018-02-11', '2018-04-08', '2018-06-10', '2018-08-05', '2018-10-28'], ['2017-10-08', '2017-11-26', '2018-02-11', '2018-05-06', '2018-07-08', '2018-09-16', '2018-10-28'], ['2017-09-03', '2017-11-26', '2018-02-11', '2018-04-08', '2018-06-10', '2018-08-05', '2018-10-28'], ['2017-08-27', '2017-10-29', '2017-12-24', '2018-02-18', '2018-04-22', '2018-07-15', '2018-09-16', '2018-11-11']], [[2.43, 2.424, 2.5780000000000003, 2.632, 2.4400000000000004, 2.258, 1.9, 1.544], [9.25, 10.75, 9.6, 8.4, 9.4, 5.6], [0.15000000000000002, 0.032, 0.09, 0.042, 0.036000000000000004, 0.0, -0.05000000000000001], [2.54, 3.2725, 0.518, 2.178, 2.7950000000000004, 2.652, 0.3375]], [[2.106666666666667, 2.312, 2.408, 2.302, 2.1759999999999997, 1.876, 1.498], [7.0, 5.4, 5.0, 5.75, 6.2, 4.333333333333333, 3.4], [0.02, -0.044, -0.042, -0.092, -0.08, -0.158, -0.15200000000000002], [0.294, -0.808, -0.7979999999999999, -0.585, -0.78, -0.7540000000000001, -0.8333333333333334, -0.7799999999999999]]], [[['2017-11-12', '2018-03-04', '2018-05-27'], ['2017-09-17', '2018-01-07', '2018-05-27', '2018-08-05', '2018-10-14'], ['2017-09-17', '2018-01-21', '2018-05-27', '2018-09-16'], ['2017-10-01', '2017-12-10', '2018-03-18', '2018-06-10', '2018-08-19', '2018-10-28']], [['2017-09-03', '2017-11-26', '2018-02-18', '2018-06-10', '2018-11-11'], ['2017-11-26', '2018-02-04', '2018-05-13', '2018-10-28'], ['2017-11-26', '2018-02-18', '2018-06-10', '2018-08-19', '2018-10-28'], ['2017-10-29', '2018-02-18', '2018-05-13', '2018-09-16']], [[2.415, 2.608, 2.387], [9.11111111111111, 10.625, 7.1, 8.9, 5.444444444444445], [0.10888888888888888, 0.07200000000000002, 0.013000000000000001, -0.05499999999999999], [1.1866666666666665, 1.7188888888888887, 1.043, 1.3244444444444448, 1.156, -0.207]], [[2.19875, 2.351, 2.4522222222222223, 2.1844444444444444, 1.5377777777777777], [6.1, 5.25, 5.833333333333333, 4.2], [-0.025, -0.02888888888888889, -0.07666666666666667, -0.13400000000000004, -0.13599999999999998], [-0.7622222222222222, -0.5, -0.7183333333333334, -0.7533333333333333]]], [[['2018-01-31', '2018-05-31'], ['2017-09-30', '2018-03-31', '2018-07-31'], ['2017-09-30', '2018-01-31', '2018-05-31', '2018-09-30'], ['2017-09-30', '2018-03-31', '2018-08-31']], [['2017-12-31', '2018-04-30'], ['2017-11-30', '2018-05-31', '2018-10-31'], ['2017-11-30', '2018-04-30', '2018-08-31'], ['2017-10-31', '2018-04-30', '2018-09-30']], [[2.5338095238095244, 2.3533333333333335], [9.055555555555555, 8.181818181818182, 7.909090909090909], [0.10722222222222222, 0.06190476190476192, -0.0022222222222222227, -0.07142857142857141], [1.1544444444444446, 0.2713636363636364, 0.3590476190476191]], [[2.3731578947368424, 2.3485714285714283], [6.454545454545454, 6.666666666666667, 4.7272727272727275], [-0.0040909090909090895, -0.05333333333333335, -0.12095238095238094], [-0.6157142857142857, -0.5452380952380953, -0.4857142857142857]]]], ['2018-11-15', 1.65, 1.5580000000000003, 5.3, -0.074, -0.5369999999999999], "CHOOBEE,Dbg,0,(1c,1m,3p,3v)"),
])
def test_oversold_fail(counter, pnlist, lasttxn, expected):
    result = scanSignals(1, counter, pnlist, lasttxn)
    assert result.replace('\t', '') == expected, "*** Input = " + counter + "," + lasttxn[0]
